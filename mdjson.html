<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>麻豆乐视</title>
	<base target="_blank" />
	<link rel="icon" href="image/zy.png" type="image/x-icon">
	<meta name="viewport"content="width=device-width, initial-scale=1, maximum-scale=1">
	<style>
	body{overflow-y:scroll;background: url(https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fpic.616pic.com%2Fbg_w1180%2F00%2F23%2F92%2FkSL8loAeSq.jpg&amp;refer=http%3A%2F%2Fpic.616pic.com&amp;app=2002&amp;size=f9999,10000&amp;q=a80&amp;n=0&amp;g=0n&amp;fmt=auto?sec=1650002525&amp;t=3cb3e3ff12943d76c5c156e399bed652) fixed no-repeat;background-size: 100% 100%;}
	.catalogue1{font-size:3.5vw;width: 100%;margin-top: 15px;margin-bottom: 15px;text-align: center;}
	.anniu{margin: 5px 5px;height: 30px;width: 90px;background: linear-gradient(to bottom,#F2EAD4,#A68B20);border-radius: 10px;}
	.catalogue2{width: 100%;height: 40%;display: none;}
	.catalogue3{width: 100%;float: left;}
	.menu{float: left;text-align: left;background: linear-gradient(to bottom,#F2EAD4,#A68B20);font-weight: bold;padding: 5px 5px;margin: 5px 5px;border-radius: 10px;width: 46%;height: 30px;}
	.links{float: left;text-decoration: aqua;text-overflow: ellipsis;overflow: hidden;white-space:nowrap;height: 25px;background: linear-gradient(to bottom,#F4F4E4,#E1CD96);color: black;font-weight: bold;padding-top: 10px; padding-right: 0px; padding-bottom: 0px; padding-left: 10px;margin: 5px -5px;border-radius: 10px;font-size: 12px;width: 100%;}
	.catalogue4{float: left;font-size:2vw;text-align: center;font-family:arial;width:100%;}
	</style>
</head>
<body>
	<div class="catalogue1">
		<input id="kw" value="" maxlength="255"  style="width: 90%;">
		<br>
		<button class="anniu" onclick="hqchannel()">获取频道</button>
		<button class="anniu" onclick="hqdata()">获取数据</button>
		</div>
<script>
function dateFormat(fmt, date) { let ret;const opt = { "Y+": date.getFullYear().toString(),  // 年
  "m+": (date.getMonth() + 1).toString(),   // 月
  "d+": date.getDate().toString(),  // 日 
};
    for (let k in opt) {  ret = new RegExp("(" + k + ")").exec(fmt);   if (ret) {    fmt = fmt.replace(ret[1], (ret[1].length == 1) ? (opt[k]) : (opt[k].padStart(ret[1].length, "0")))   };   };  return fmt;}
var time=dateFormat("YYYYmmdd", new Date());
//console.log(time)
document.getElementById('kw').value="https://jsonmdtv.md29.tv/upload_json_live/"+time+"/videolist_"+time+"_10_2_-_-_100_1.json";  //原网站：https://g1wj66sh7.com
</script>
	<div class="catalogue2"></div>
	<div class="catalogue3"  id="demo"></div>
<script>
	function hqchannel() {
		console.time('渲染耗时')
		var httpRequest = new XMLHttpRequest();
			httpRequest.open('GET','./js/channel.json' , true);
			httpRequest.send();
			httpRequest.onreadystatechange = function () {
				if (httpRequest.readyState == 4 && httpRequest.status == 200) {
				var channel = JSON.parse(httpRequest.responseText);	
				//https://index.madou19.tv/json/umi.bf450141.js  调用 r = e.res; 上3行的catch((function (t)
				//console.log(channel)
				var zfc = JSON.stringify(channel.data, [ 'id', 'name', 'total'])
				var obj = JSON.parse(zfc)
				//console.log(obj);
				var txt='';
				for(var i=0;i<obj.length;i++){
					txt=txt+'<button class="menu" onclick="clicked('+obj[i].id+')">'+obj[i].id+':&nbsp;&nbsp;'+obj[i].name+ '&nbsp;-&nbsp;'+obj[i].total+ '</button>';
				//console.log(txt)

	}
		document.getElementById('demo').innerHTML=txt;
	}}
		console.timeEnd('渲染耗时')
	}

	function hqdata() {
	 var url=document.getElementById('kw').value;
	 var httpRequest = new XMLHttpRequest();
			httpRequest.open('GET',url , true);
			httpRequest.send();
			httpRequest.onreadystatechange = function () {
				if (httpRequest.readyState == 4 && httpRequest.status == 200) {
					var json = httpRequest.responseText;
				   // console.log(json);
		var obj = JSON.parse(json); //由JSON字符串转换为JSON对象
		//console.log(obj)
		var zfc = JSON.stringify(obj.data,['title','video_url']); //由JSON对象转换为JSON字符串
		var newd=JSON.parse(zfc);//由JSON字符串转换为JSON对象
			newd.forEach((val,index)=>{
				val["video_url"]='http://www.wbdyba.com/js/player/?url='+val["video_url"];// 修改 把video_url修改
				//val["LimitAccount"]=188.0;//增加
				// delete val["CustName"];// 删除
			})
		//console.log(newd);// 输出对象
		var txt='';
			for(var i=0;i<newd.length;i++){
				txt=txt+'<a class="links" href="'+newd[i].video_url+'">'+(i+1)+":"+newd[i].title+ '</a>';
				//console.log(txt)
			}
		document.getElementById('demo').innerHTML=txt;
		}};}

	function clicked(channel) {
		var s,ss;
		var s=document.getElementById('kw').value;
		ss=s.split("_");
		ss[7]=channel;
		s=ss.join("_");
		//console.log(s,ss);
			document.getElementById('kw').value=s;
			hqdata();
	}
	</script>
	<div class="catalogue4" style="margin-top:20vh;font-size: 3vw;">Lews&nbsp;by&nbsp;Website&nbsp;Server!</div>
</body>
</html>
